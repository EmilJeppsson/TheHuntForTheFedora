<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>The Hunt For The Fedora</title>
  <!-- Phaser-APIn hämtas från ett content delivery network istället för att sparas lokalt.
  Fördelarna med detta är att projektet får en mycket mindre storlek och att versionen
  på Phaser kan uppdateras endast genom att ändra adressen. -->
  <script src="//cdn.jsdelivr.net/npm/phaser@3.3.0/dist/phaser.js"></script>
</head>
<body>
  <script type='text/javascript'>
  var config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      physics: {
          default: 'arcade',
          arcade: {
              gravity: { y: 600 },
              debug: true
          }
      },
      scene: {
          preload: preload,
          create: create,
          update: update
      }
  };

  //Alla variabler måste definas globalt för att assignments från tex. create() inte ska försvinna när funktionen löper ut.
  var player;
  var platforms;
  var worldbounds;
  var cursors;
  var music;

  var game = new Phaser.Game(config);

  function preload () //Laddar alla assets som spelet behöver innan scenen skapas
  {
    this.load.image('sky', 'assets/pictures/sky.png');
    this.load.image('sky2', 'assets/pictures/sky2.png');
    this.load.image('ground', 'http://labs.phaser.io/src/games/firstgame/assets/platform.png');
    this.load.image('neethouse', 'assets/pictures/emil/neethouse.png');
    this.load.image('tree', 'assets/pictures/andreas/tree.png');
    this.load.image('worldbound', 'assets/pictures/invisiblewall.png');
    this.load.image('obstaclehouse', 'assets/pictures/emil/hus5.png');
    this.load.image('houseplatform1', 'assets/pictures/emil/houseplatform1.png');
    this.load.image('houseplatform2', 'assets/pictures/emil/houseplatform2.png');
    this.load.image('lefthousewall', 'assets/pictures/emil/leftwall.png');
    this.load.image('righthousewall', 'assets/pictures/emil/rightwall.png');
    this.load.image('invisibleplatform', 'assets/pictures/emil/invisibleplatform.png');
    this.load.spritesheet('neet', 'assets/pictures/n33t.png', { frameWidth: 94, frameHeight: 150 });
    this.load.audio('theme', ['assets/audio/victor/Neckbeard2.mp3']);
  }

  function create () //Skapar scenen. Scenen byggs sekventiellt. Detta betyder att ju senare en bild skapas, desto högre prioritet får den.
  {
    this.add.image(1500, 300, 'sky'); //En basic himmel som bakgrund.
    this.add.image(4500, 300, 'sky');
    this.add.image(1500, 900, 'sky2'); //sky2 är en horisontell spegelvändning av sky. Det gör att den kan placeras ovanför och under sky med en smooth övergång.
    this.add.image(4500, 900, 'sky2');
    this.add.image(1500, -300, 'sky2');
    this.add.image(4500, -300, 'sky2');
    this.add.image(300, 320, 'neethouse');
    this.add.image(800, 350, 'tree');


    platforms = this.physics.add.staticGroup();
    platforms.create(400, 568, 'ground').setScale(2).refreshBody();
    platforms.create(1200, 568, 'ground').setScale(2).refreshBody();
    //platforms.create(1000, 695, 'ground').setScale(6).refreshBody();
    platforms.create(2200, 568, 'ground').setScale(2).refreshBody();
    platforms.create(3000, 568, 'ground').setScale(2).refreshBody();
    platforms.create(3300, 568, 'ground').setScale(2).refreshBody();
    platforms.create(3000, 568, 'ground').setScale(2).refreshBody();
    platforms.create(2200, 360, 'ground').setScale(0.5).refreshBody();
    platforms.create(1900, 160, 'ground').setScale(0.5).refreshBody();

    platforms.create(2300, 285, 'lefthousewall');
    platforms.create(3296, 72, 'righthousewall');
    platforms.create(2685, 45, 'houseplatform1');
    platforms.create(2885, 313, 'houseplatform2');
    platforms.create(2814, -195, 'invisibleplatform');

    this.add.image(2800, 20, 'obstaclehouse');

    worldbounds = this.physics.add.staticGroup();
    worldbounds.create(500, 400, 'worldbound');

    player = this.physics.add.sprite(2300, 450, 'neet'); //Ska vara 700, 450

    this.physics.add.collider(player, platforms);
    this.physics.add.collider(player, worldbounds);

    //this.cameras.main.setSize(800, 600);
    this.cameras.main.startFollow(player, 100, null, null);
    //console.log(this.cameras.main);

    //Ser till att kontrollerna fungerar efter att create() löpt ut
    cursors = this.input.keyboard.createCursorKeys();

    //  Spelaranimationerna
    this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('neet', { start: 0, end: 1 }),
        frameRate: 7,
        repeat: -1
    });

    this.anims.create({
        key: 'turn',
        frames: [ { key: 'neet', frame: 2 } ],
        frameRate: 20
    });

    this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('neet', { start: 3, end: 4 }),
        frameRate: 7,
        repeat: -1
    });
    music = this.sound.add('theme');

    //Bakgrundsmusik
    music.play();
  }

  function update () //Sköter uppdateringar till scenen som tex kontroll av huvudkaraktären
  {
    if (cursors.left.isDown)
    {
      player.setVelocityX(-300);
      player.anims.play('left', true);
    }
    else if (cursors.right.isDown)
    {
      player.setVelocityX(300);
      player.anims.play('right', true);
    }
    else
    {
      player.setVelocityX(0);
      player.anims.play('turn');
    }

    if (cursors.up.isDown /*&& player.body.touching.down*/)
    {
      player.setVelocityY(-500);
    }
  }

  </script>
</body>
</html>
